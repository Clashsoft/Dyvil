package dyvil.experimental

public class OptionalTest
{
	static func apply() -> Test = test "Optionals" {
		let optString: String? = "abc"
		let string: String = optString ?? "def" // = "abc"

		let optUppercase: String? = optString?.toUpperCase
		// = optString == null ? null : optString!!.toUpperCase

		// ALOAD optString
		// IFNULL elseLabel
		// ALOAD optString
		// INVOKEVIRTUAL String.toUpperCase(): String
		// elseLabel: ACONST_NULL

		let optUppercaseFirst: char? = optString?.toUpperCase?[0]

		// ALOAD optString
		// IFNULL elseLabel
		// ALOAD optString
		// INVOKEVIRTUAL String.toUpperCase(): String
		// DUP
		// ASTORE sideEffect$0
		// IFNULL elseLabel
		// ALOAD sideEffect$0
		// INVOKESTATIC StringExtensions.subscript(String, int): String
		// elseLabel: ACONST_NULL

		// ------ Bytecode of a 'value?' expression
		// EVAL receiver
		// DUP
		// ASTORE newVar
		// IFNULL elseLabel
		// ALOAD newVar
	}
}
