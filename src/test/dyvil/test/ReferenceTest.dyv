package dyvil.test

public class ReferenceTest
{
	static void inc(int^ i) = i.set(i.get + 1)

	static int staticField = 0

	static class Holder
	{
		public int instanceField = 0
	}

	static case class ImmutableHolder(public final int value)
	{
		public func +(int value): ImmutableHolder = apply(this.value + value)

		public postfix func +=(ImmutableHolder^ holder, int value): void = holder.set(holder.get + value)
	}

	public static void main([String] args)
	{
		testFieldReference()
		testVariableReference()
		testReceiverReference()
	}

	private static void testFieldReference()
	{
		inc staticField
		Main.test("Static Field Reference", 1, staticField)

		Holder holder = new Holder
		inc holder.instanceField
		Main.test("Instance Field Reference", 1, holder.instanceField)
	}

	private static void testVariableReference()
	{
		int variable = 0
		inc variable
		Main.test("Variable Reference", 1, variable)

		int capturedVariable = 0
		`repeat`(3) { inc capturedVariable }
		Main.test("Captured Variable Reference", 3, capturedVariable)
	}

	private static void testReceiverReference()
	{
		ImmutableHolder holder = ImmutableHolder(0)
		holder += 1
		Main.test("Receiver Field Reference", holder.value, 1)
	}
}
