package dyvil.test

import dyvil.tests._
using dyvil.Test

public class Main
{
	private static var errors = List<String>

	public static void main([String] args)
	{
		runTests(args)
		verify()
	}
		
	private static void runTests([String] args)
	{
		let test = test "Main" {
			AnnotationTest()
			ArrayTest()
			AssignmentTest()
			BridgeTest()
			ConstructorTest()
			DPFTest()
			ExtensionTest()
			FibonacciTest()
			HanoiTest()
			ImplicitTest()
			MathTest()
			NestedMethodTest()
			ObjectTest()
			OperatorTest()
			PrimitiveTest()
			PropertyTest()
			SuperTest()
			TypeTest()
		}
		test.addErrors(errors)

		BuilderTest.main(args)
		CaptureTest.main(args)
		CaseClassTest.main(args)
		ForTest.main(args)
		InheritanceTest.main(args)
		IntrinsicTest.main(args)
		LambdaTest.main(args)
		MatchTest.main(args)
		OverloadTest.main(args)
		RangeTest.main(args)
		ReferenceTest.main(args)
		ReifyTest.main(args)
		SortTest.main(args)
		VirtualStaticTest.main(args)
		VarargsTest.main(args)
	}

	private static void verify()
	{
		if (errors.isEmpty)
		{
			return
		}

		errors.forEach(print _)
		throw new AssertionError()
	}

	public static void error(String message)
	{
		errors.add message
	}

	public static void test(String testName, any! expected, any! actual)
	{
		test(testName, expected, actual, expected == actual)
	}

	public static void testString(String testName, any expected, any actual)
	{
		test(testName, expected, actual, expected.toString == actual.toString)
	}

	public static void test(String testName, any expected, any actual, boolean condition)
	{
		if (!condition)
		{
			errors.add "\(testName) FAILED:\n\texpected: \(expected)\n\tactual:   \(actual)"
		}
	}

	public static void test(String testName, boolean condition)
	{
		if (!condition)
		{
			errors.add "\(testName) FAILED"
		}
	}
}
